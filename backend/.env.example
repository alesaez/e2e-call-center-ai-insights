# Backend Environment Variables for Local Development
# Copy this file to .env and fill in your values

# =============================================================================
# üîí DEVELOPMENT MODE OPTIONS (Security Warnings)
# =============================================================================

# SSL Verification Bypass (for corporate proxy environments)
# ‚ö†Ô∏è  WARNING: Only use in development when behind corporate proxies with SSL inspection
# ‚ö†Ô∏è  NEVER enable this in production environments!
# Set to 'true' to disable SSL certificate verification globally (affects MSAL, httpx, all connections)
# Use when you get "certificate verify failed: self-signed certificate in certificate chain" errors
# DISABLE_SSL_VERIFY=false

# RBAC Bypass for Development
# ‚ö†Ô∏è  WARNING: Only use for local development/testing without app role assignments
# ‚ö†Ô∏è  NEVER enable this in production environments!
# Set to 'true' to bypass all RBAC checks (all authenticated users get Administrator role)
# DISABLE_RBAC=false

# =============================================================================
# üîê AUTHENTICATION & AUTHORIZATION
# =============================================================================

# Microsoft Entra ID Configuration
# These should match your backend app registration in Azure Portal
ENTRA_TENANT_ID=your-tenant-id-here
ENTRA_CLIENT_ID=your-backend-client-id-here

# CORS Configuration
# Add your frontend URLs (comma-separated for production)
ALLOWED_ORIGINS=["http://localhost:3000", "http://localhost:5173"]

# =============================================================================
# üí¨ CHAT SERVICES (Optional - Configure at least one)
# =============================================================================

# Copilot Studio Configuration (Optional - for CS Chatbot integration)
# Get these values from your Copilot Studio agent in Power Platform
# Direct Connect URL (optional, leave empty to use default)
COPILOT_STUDIO_DIRECT_CONNECT_URL=
# Power Platform environment ID where your Copilot Studio agent is deployed
COPILOT_STUDIO_ENVIRONMENT_ID=your-environment-id-here
# Schema name of your Copilot Studio agent (e.g., crb64_myAgent)
COPILOT_STUDIO_SCHEMA_NAME=your-agent-schema-name-here
# Microsoft Entra ID tenant ID (usually same as ENTRA_TENANT_ID above)
COPILOT_STUDIO_TENANT_ID=your-tenant-id-here
# App registration client ID for Copilot Studio access (can use same as ENTRA_CLIENT_ID)
COPILOT_STUDIO_APP_CLIENT_ID=your-backend-client-id-here
# App registration client secret (required for On-Behalf-Of flow)
COPILOT_STUDIO_APP_CLIENT_SECRET=your-client-secret-value-here

# Azure Cosmos DB Configuration (Optional - for chat history persistence)
# NEW: Two-container architecture for optimal performance and scalability

# Azure Cosmos DB Configuration (Optional - for chat history persistence)
# Authentication: Uses DefaultAzureCredential for localhost and ManagedIdentityCredential for Azure Container Apps
# 
# Cosmos DB account URI (required)
COSMOS_DB_ACCOUNT_URI=https://your-cosmosdb-account.documents.azure.com:443/

# Database and Container Configuration:
# Database name for chat history (will be created if not exists)
COSMOS_DB_DATABASE_NAME=ContosoSuites
# Sessions container - partitioned by userId for efficient user queries
COSMOS_DB_SESSIONS_CONTAINER=Sessions
# Messages container - partitioned by sessionId for optimal message retrieval
COSMOS_DB_MESSAGES_CONTAINER=Messages

# Schema Information:
# Sessions Container Schema:
# - Partition Key: userId
# - Documents: Chat sessions with metadata (title, createdAt, lastActiveAt, model, etc.)
# 
# Messages Container Schema:
# - Partition Key: sessionId  
# - Documents: Individual messages with role, content, tokens, attachments, grounding, etc.

# Azure AI Foundry Configuration (Optional - for AI Foundry Chatbot integration)
# Get these values from your AI Foundry project in Azure AI Studio
# AI Foundry project endpoint (e.g., https://xxx-aifoundry.services.ai.azure.com/api/projects/YourProject)
AI_FOUNDRY_ENDPOINT=https://your-aifoundry.services.ai.azure.com/api/projects/YourProject
# AI Foundry agent ID (e.g., asst_xxxxxxxxxxxxx)
AI_FOUNDRY_AGENT_ID=asst_xxxxxxxxxxxxx
# Microsoft Entra ID tenant ID (usually same as ENTRA_TENANT_ID above)
AI_FOUNDRY_TENANT_ID=your-tenant-id-here
# App registration client ID for AI Foundry access (can use same as ENTRA_CLIENT_ID)
AI_FOUNDRY_APP_CLIENT_ID=your-backend-client-id-here
# App registration client secret (required for On-Behalf-Of flow to Azure AI services)
AI_FOUNDRY_APP_CLIENT_SECRET=your-client-secret-value-here
# Azure OpenAI configuration for AI-generated follow-up questions (Optional)
# If not provided, uses the OpenAI connection from your AI Foundry project
AI_FOUNDRY_OPENAI_ENDPOINT=https://your-openai-resource.openai.azure.com/
AI_FOUNDRY_OPENAI_DEPLOYMENT=gpt-4o
AI_FOUNDRY_OPENAI_API_VERSION=2024-08-01-preview
AI_FOUNDRY_ENABLE_QUESTION_SUGGESTIONS=true

# Power BI Embedded Configuration (Optional - for Power BI report embedding)
# Supports two authentication modes:
# 1. Service Principal (POWERBI_USE_SERVICE_PRINCIPAL=true)
#    - Uses app-only authentication with Power BI Service API
#    - Requires Power BI Service Admin permissions granted to the service principal
#    - More secure as it doesn't require user tokens
# 2. On-Behalf-Of flow (default, POWERBI_USE_SERVICE_PRINCIPAL=false)
#    - Uses user's permissions to access Power BI
#    - IMPORTANT: Users must have explicit workspace role (Admin, Member, Contributor, or Viewer)
#    - Direct report sharing is NOT sufficient - users need workspace-level access
#    - If users get 401 errors but can view reports in Power BI portal, add them to the workspace

# Microsoft Entra ID tenant ID (usually same as ENTRA_TENANT_ID above)
POWERBI_TENANT_ID=your-tenant-id-here
# App registration client ID (service principal for mode 1, backend app for mode 2)
POWERBI_CLIENT_ID=your-powerbi-client-id-here
# App registration client secret
POWERBI_CLIENT_SECRET=your-powerbi-client-secret-here
# Power BI workspace (group) ID where your report is located
# Get this from Power BI workspace URL or REST API
POWERBI_WORKSPACE_ID=your-workspace-id-here
# Power BI report ID to embed
# Get this from Power BI report URL or REST API
POWERBI_REPORT_ID=your-report-id-here
# Authentication mode: true = Service Principal, false = On-Behalf-Of flow (default)
POWERBI_USE_SERVICE_PRINCIPAL=false

# Microsoft Fabric Lakehouse Configuration (Optional - for Dashboard KPIs with real-time data)
# ‚ö†Ô∏è  FULLY OPTIONAL: Leave all FABRIC_* variables commented/unset to use mock data
# ‚ö†Ô∏è  Only uncomment and configure if you want real-time data from Fabric Lakehouse
# ‚ö†Ô∏è  Requires: ODBC Driver 18 for SQL Server installed on your machine
#
# If not configured, the dashboard will automatically use mock data without errors
# To enable Fabric integration, you MUST configure ALL required fields below:

# Fabric SQL endpoint - can include https:// or just the hostname
# Example: https://your-workspace.datawarehouse.fabric.microsoft.com
# ‚ö†Ô∏è  REQUIRED: This triggers Fabric initialization - leave unset to disable
# FABRIC_ENDPOINT=https://your-workspace.datawarehouse.fabric.microsoft.com

# Fabric workspace ID (get from workspace URL in Fabric portal)
# ‚ö†Ô∏è  REQUIRED if FABRIC_ENDPOINT is set
# FABRIC_WORKSPACE_ID=your-workspace-id-here

# Fabric lakehouse NAME (not the GUID - this is used as the database name)
# Get this from your lakehouse display name in Fabric portal (e.g., "CallCenterAnalytics")
# ‚ö†Ô∏è  REQUIRED if FABRIC_ENDPOINT is set
# FABRIC_LAKEHOUSE_ID=your-lakehouse-name-here

# Microsoft Entra ID tenant ID (usually same as ENTRA_TENANT_ID above)
# ‚ö†Ô∏è  REQUIRED if FABRIC_ENDPOINT is set
# FABRIC_TENANT_ID=your-tenant-id-here

# Authentication: Automatically detects environment
# - Local development: Uses DefaultAzureCredential (requires 'az login')
# - Azure Container Apps: Uses ManagedIdentityCredential (automatic)
# - Optional: Service Principal authentication (uncomment if needed)
# FABRIC_CLIENT_ID=your-service-principal-client-id-here
# FABRIC_CLIENT_SECRET=your-service-principal-secret-here

# Connection timeouts (optional, defaults shown)
# FABRIC_CONNECTION_TIMEOUT=30
# FABRIC_QUERY_TIMEOUT=60

# =============================================================================
# üéõÔ∏è UI CONFIGURATION
# =============================================================================

# UI Configuration Environment
# Determines which environment settings to use from ui-config.json
# Valid values: dev, staging, prod
UI_CONFIG_ENVIRONMENT=prod

# UI Configuration File: backend/ui-config.json
# 
# The ui-config.json file controls:
#   - Tab visibility (display: true/false)
#   - Service loading (load: true/false)
#   - Tab labels (name, title, subtitle)
#   - Environment-specific overrides
# 
# Edit backend/ui-config.json to customize:
#   - Which tabs appear in the navigation
#   - Tab display names, titles, and subtitles
#   - Different configurations per environment (dev/staging/prod)
#   - Which backend services are loaded
# 
# Example use cases:
#   - Hide Power BI in dev: Set powerbi.overrides.dev.display = false
#   - Custom tab name in prod: Set copilot-studio.overrides.prod.labels.name = "Support Bot"
#   - Disable a service: Set <tab>.load = false (service won't initialize)

# =============================================================================
# ÔøΩ OBSERVABILITY & TRACING (Optional)
# =============================================================================

# Enable Gen AI content recording for Azure Monitor / Application Insights tracing
# When 'true', the actual prompts and responses sent to AI models are captured in traces
# ‚ö†Ô∏è  WARNING: May capture sensitive data in traces - use 'false' in production
# Default: false
AZURE_TRACING_GEN_AI_CONTENT_RECORDING_ENABLED=true

# =============================================================================
# ÔøΩüîß DEBUGGING & LOGGING
# =============================================================================

# Azure SDK Verbose Logging (for development debugging only)
# Set to 'true' to enable detailed Azure SDK HTTP logging
# WARNING: This will log HTTP requests/responses and may expose sensitive data
# AZURE_SDK_VERBOSE_LOGGING=false

# =============================================================================
# üõ†Ô∏è TROUBLESHOOTING
# =============================================================================

# Common Issues and Solutions:

# Issue: "certificate verify failed: self-signed certificate in certificate chain"
# Solution: Set DISABLE_SSL_VERIFY=true (corporate proxy with SSL inspection)
# Location: Add at top of file under "DEVELOPMENT MODE OPTIONS"

# Issue: "Data source name not found and no default driver specified" (Fabric)
# Solution: Install ODBC Driver 18 for SQL Server OR comment out all FABRIC_* variables
# Location: https://learn.microsoft.com/sql/connect/odbc/download-odbc-driver-for-sql-server

# Issue: User gets 401 on Power BI but can view in Fabric portal
# Solution: Add user to Power BI workspace with Viewer role (not just report sharing)
# Location: Power BI workspace settings > Access > Add user

# Issue: "Azure AI User role" required for AI Foundry
# Solution: Assign role to Azure AD Security Group, add users to group
# Location: Azure Portal > AI Foundry resource > Access Control (IAM)


